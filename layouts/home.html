{{ define "main" }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    {{ $shuoshuo := where .Site.RegularPages "Type" "shuoshuo" }}
    {{ $latest_shuoshuo := $shuoshuo | first 10 }}

    {{ if gt (len $latest_shuoshuo) 0 }}
    <div class="notice-board-container">
        <div class="notice-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-message-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
               <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
               <path d="M8 9h8"></path>
               <path d="M8 13h6"></path>
               <path d="M9 18h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-3l-3 3l-3 -3z"></path>
            </svg>
        </div>

        <div class="swiper myNoticeSwiper">
            <div class="swiper-wrapper">
                {{ range $latest_shuoshuo }}
                <div class="swiper-slide notice-slide">
                    <a href="/shuoshuo/" class="notice-link">
                        <span class="notice-text">
                            <span class="notice-time-ago" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                                {{ .Date.Format "2006-01-02" }}
                            </span>：{{ .Plain | truncate 60 }}
                        </span>
                    </a>
                </div>
                {{ end }}
            </div>
        </div>
        
        <div class="notice-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <polyline points="9 6 15 12 9 18" />
            </svg>
        </div>
    </div>
    {{ end }}

    {{ $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections }}
    {{ $pages = where $pages "Type" "!=" "shuoshuo" }}
    
    <section class="article-list">
        {{ $paginator := .Paginate $pages }}
        {{ range $paginator.Pages }}
            {{ partial "article-list/default" . }}
        {{ end }}
    </section>

    {{ partial "pagination.html" . }}
    {{ partial "footer/footer" . }}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 1. 初始化 Swiper
            if (typeof Swiper !== 'undefined') {
                new Swiper(".myNoticeSwiper", {
                    direction: 'vertical',
                    slidesPerView: 1,
                    spaceBetween: 0,
                    allowTouchMove: true,
                    mousewheel: true,
                    autoplay: {
                        delay: 2500,
                        disableOnInteraction: false,
                    },
                    loop: true,
                });
            }

            // 2. 首页轮播时间计算逻辑
            const timeElements = document.querySelectorAll('.notice-time-ago');
            const now = new Date();

            timeElements.forEach(el => {
                const dateStr = el.getAttribute('datetime');
                const date = new Date(dateStr);
                const diff = (now - date) / 1000; // 差距秒数

                let text = el.innerText; // 默认保留原日期 (现在是 2022-08-22 这种格式)
                
                if (diff < 60) {
                    text = '刚刚';
                } else if (diff < 3600) {
                    text = Math.floor(diff / 60) + ' 分钟前';
                } else if (diff < 86400) {
                    text = Math.floor(diff / 3600) + ' 小时前';
                } else if (diff < 2592000) { 
                    text = Math.floor(diff / 86400) + ' 天前';
                } else if (diff < 31536000) { 
                    text = Math.floor(diff / 2592000) + ' 个月前';
                }
                // 如果 diff > 31536000 (1年)，上面的 if 都不满足
                // text 依然保持 el.innerText 的初始值 (即 2006-01-02 格式)
                
                el.innerText = text;
            });
        });
    </script>
{{ end }}

{{ define "right-sidebar" }}
    {{ partial "sidebar/right.html" (dict "Context" . "Scope" "homepage") }}
{{ end }}