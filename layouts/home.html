{{ define "main" }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    {{/* 获取最近的 10 条说说 */}}
    {{ $shuoshuo := where .Site.RegularPages "Type" "shuoshuo" }}
    {{ $latest_shuoshuo := $shuoshuo | first 10 }}

    {{/* 只有当存在说说时才显示轮播条 */}}
    {{ if gt (len $latest_shuoshuo) 0 }}
    <div class="notice-board-container">
        <div class="notice-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-message-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
               <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
               <path d="M8 9h8"></path>
               <path d="M8 13h6"></path>
               <path d="M9 18h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-3l-3 3l-3 -3z"></path>
            </svg>
        </div>

        <div class="swiper myNoticeSwiper">
            <div class="swiper-wrapper">
                {{ range $latest_shuoshuo }}
                <div class="swiper-slide notice-slide">
                    <a href="/shuoshuo/" class="notice-link">
                        <span class="notice-text">
                            <span class="notice-time-ago" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                                {{ .Date.Format "2006-01-02" }}
                            </span>：{{ .Plain | truncate 60 }}
                        </span>
                    </a>
                </div>
                {{ end }}
            </div>
        </div>
        
        <div class="notice-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <polyline points="9 6 15 12 9 18" />
            </svg>
        </div>
    </div>
    {{ end }}

    {{/* 获取文章列表（排除说说） */}}
    {{ $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections }}
    {{ $pages = where $pages "Type" "!=" "shuoshuo" }}
    
    <section class="article-list">
        {{ $paginator := .Paginate $pages }}
        {{ range $paginator.Pages }}
            {{ partial "article-list/default" . }}
        {{ end }}
    </section>

    {{ partial "pagination.html" . }}
    {{ partial "footer/footer" . }}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 1. 初始化 Swiper
            if (typeof Swiper !== 'undefined') {
                new Swiper(".myNoticeSwiper", {
                    direction: 'vertical',
                    slidesPerView: 1,
                    spaceBetween: 0,
                    allowTouchMove: true,
                    mousewheel: true,
                    autoplay: {
                        delay: 2000,
                        disableOnInteraction: false,
                        pauseOnMouseEnter: true, // 【功能点1】鼠标悬停时停止自动播放
                    },
                    loop: true,
                });
            }

            // 2. 首页轮播时间计算逻辑
            const timeElements = document.querySelectorAll('.notice-time-ago');
            const now = new Date();

            timeElements.forEach(el => {
                const dateStr = el.getAttribute('datetime');
                if (!dateStr) return; // 防止报错
                const date = new Date(dateStr);
                const diff = (now - date) / 1000; // 差距秒数

                // ===== 【功能点3】生成“年月日 时分”格式 =====
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hour = String(date.getHours()).padStart(2, '0');
                const minute = String(date.getMinutes()).padStart(2, '0');
                const exactTime = year + '-' + month + '-' + day + ' ' + hour + ':' + minute;

                // 设置 title 属性 (实现鼠标悬停显示具体时间)
                el.setAttribute('title', exactTime);

                // ===== 【功能点2】强制纯相对时间逻辑 =====
                let text = ''; 
                
                if (diff < 60) {
                    text = '刚刚';
                } else if (diff < 3600) {
                    text = Math.floor(diff / 60) + ' 分钟前';
                } else if (diff < 86400) {
                    text = Math.floor(diff / 3600) + ' 小时前';
                } else if (diff < 2592000) { 
                    text = Math.floor(diff / 86400) + ' 天前';
                } else if (diff < 31536000) { 
                    text = Math.floor(diff / 2592000) + ' 个月前';
                } else {
                    // 超过一年，强制显示“X年前”，不再显示具体日期
                    text = Math.floor(diff / 31536000) + ' 年前';
                }
                
                el.innerText = text;
            });
        });
    </script>
{{ end }}

{{ define "right-sidebar" }}
    {{ partial "sidebar/right.html" (dict "Context" . "Scope" "homepage") }}
{{ end }}